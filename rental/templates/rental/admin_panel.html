{% extends 'rental/base.html' %} 
{% block title %}Panel Admina - WypoÅ¼yczalnia
{%endblock %} {% block content %}
<h1>ğŸ“Š Panel Administratora</h1>

<h2>ğŸ› ï¸ SprzÄ™t</h2>
<table>
  <thead>
    <tr>
      <th>Nazwa</th>
      <th>Kategoria</th>
      <th>Opis</th>
      <th>DostÄ™pny</th>
      <th>Akcja</th>
    </tr>
  </thead>
  <tbody>
    {% for item in equipment %}
    <tr>
      <td>{{ item.name }}</td>
      <td>{{ item.get_category_display }}</td>
      <td>{{ item.description }}</td>
      <td id="status-{{ item.id }}">
        {% if item.is_available %}
        <span class="available">âœ… Tak</span>
        {% else %}
        <span class="unavailable">âŒ Nie</span>
        {% endif %}
      </td>
      <td>
        <button class="btn" data-equipment-id="{{ item.id }}" onclick="toggleAvailability(this.dataset.equipmentId)">ZmieÅ„ status</button>

      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top: 2rem">ğŸ“‹ Wszystkie WynajÄ™cia</h2>
<table>
  <thead>
    <tr>
      <th>UÅ¼ytkownik</th>
      <th>SprzÄ™t</th>
      <th>Data wynajmu</th>
      <th>Data zwrotu</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    {% for rental in rentals %}
    <tr>
      <td>{{ rental.user.username }}</td>
      <td>{{ rental.equipment.name }}</td>
      <td>{{ rental.rental_date|date:"d.m.Y" }}</td>
      <td>{{ rental.return_date|date:"d.m.Y" }}</td>
      <td>
        {% if rental.status == 'active' %}
        <span class="status-active">âœ… Aktywne</span>
        {% elif rental.status == 'completed' %}
        <span class="status-completed">â±ï¸ UkoÅ„czone</span>
        {% else %}
        <span class="status-cancelled">âŒ Anulowane</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<p style="margin-top: 2rem">
  <a href="{% url 'index' %}">â† PowrÃ³t do strony gÅ‚Ã³wnej</a>
</p>

<script>
function toggleAvailability(equipmentId) {
    const csrftoken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    fetch(`/admin/toggle-availability/${equipmentId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('BÅ‚Ä…d: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('BÅ‚Ä…d serwera');
    });
}
</script>


{% endblock %}
